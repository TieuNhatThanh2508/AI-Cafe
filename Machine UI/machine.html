<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coffee Sorting - Live & Report</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./machine.css" />
</head>

<body>
    <div class="main-wrapper">
        <!-- CAMERA MODULE -->
        <div id="cameraModule" class="module">
            <h4 id="machineStatus">
                <span class="status-dot" style="background-color: #ff0000;"></span> Đang dừng
            </h4>
            <video id="liveFeed" autoplay muted></video>
            <div class="btn-group mt-3">
                <button class="btn btn-success" onclick="startMachine()">Bắt Đầu</button>
                <button class="btn btn-danger" onclick="stopMachine()">Dừng</button>
            </div>
        </div>
    </div>

    <!-- MODAL CHUẨN BỊ TRƯỚC KHI BẮT ĐẦU -->
    <div id="prepModal" class="app-modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Chuẩn bị trước khi bắt đầu</h5>
                </div>
                <div class="modal-body">
                    <ul>
                        <li>Chuẩn bị 300g hạt</li>
                        <li>Bật băng chuyền</li>
                        <li>Khởi động động cơ rung</li>
                        <li>Bật đèn LED (nếu có)</li>
                        <li>Chuẩn bị rút phễu</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="cancelPrep()">Hủy</button>
                    <button class="btn btn-primary" onclick="confirmPrep()">Xác nhận</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL BÁO CÁO -->
    <div id="reportModal" class="app-modal">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Báo Cáo Phân Loại</h5>
                </div>
                <div class="modal-body">
                    <div class="row report-layout">
                        <!-- CỘT 1: Thống kê số lượng -->
                        <div class="col stats-col">
                            <div class="count-row"><span class="label green">Hạt Xanh:</span> <span
                                    id="greenCount">0</span></div>
                            <div class="count-row"><span class="label gray">Hạt Đen:</span> <span
                                    id="blackCount">0</span></div>
                            <div class="count-row"><span class="label yellow">Hạt Chua:</span> <span
                                    id="sourCount">0</span></div>
                            <div class="count-row"><span class="label purple">Hạt Bể:</span> <span
                                    id="brokenCount">0</span></div>
                            <div class="count-row"><span class="label orange">Hạt Sém:</span> <span
                                    id="scorchedCount">0</span></div>
                            <div class="count-row mt-2 fw-bold">Tổng số hạt: <span id="totalCount">0</span></div>
                        </div>

                        <!-- CỘT 2: Biểu đồ -->
                        <div class="col chart-col text-center">
                            <canvas id="pieChartClassification" width="220" height="220"></canvas>
                        </div>

                        <!-- CỘT 3: Đánh giá & lời khuyên -->
                        <div class="col advice-col">
                            <div id="qualityEvaluation" class="quality-box">
                                <h6>Đánh giá chất lượng</h6>
                                <p id="defectScoreText">Điểm lỗi: --</p>
                                <p id="qualityGradeText">Phân loại: --</p>
                                <hr />
                                <p id="qualityDescription">Mô tả: --</p>
                                <p id="qualityImprovement">Gợi ý cải thiện: --</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="resetAll()">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="./machine.js"></script>
</body>

</html>